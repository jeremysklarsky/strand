<link rel="import" href="../js/rectangle.html">
<link rel="import" href="windownotifier.html">
<link rel="import" href="autoclosable.html">
<link rel="import" href="stylable.html">
<script type="text/javascript">
	
(function(scope) {

	var Rectangle = StrandLib.Rectangle;

	var Positionable = {

		properties: {
			target: {
				type: Object
			},
			state: {
				type: String,
				value: 'closed',
				observer: '_stateChanged'
			},
			offset: {
				type: Number,
				value: 0
			},
			boundaryOffset: {
				type: Number,
				value: 10
			},
			_containerStyle: {
				type: String,
				computed: '_computeContainerStyle(boundaryOffset)'
			}
		},

		resize: function() {
			this.update();
		},
		
		scroll: function() {
			this.update();
		},

		update: function () {
			if(!this.target) return;

			this._updatePosition();
		},

		_updatePosition: function() {},

		get metrics() {
			return Rectangle.fromElement(this);
		},

		get targetMetrics() {
			return this.target && Rectangle.fromElement(this.target);
		},

		get windowMetrics() {
			return new Rectangle(0, 0, document.documentElement.clientWidth, document.documentElement.clientHeight);
		},

		_stateChanged: function(newState, oldState) {
			if (newState === this.STATE_OPENED) {
				this.update();
				this.style.clip = "auto";
			} else {
				this.style.clip = "rect(0,0,0,0)";
			}
		},

		_computeContainerStyle: function(boundaryOffset) {
			return this.styleBlock({
				padding: boundaryOffset + 'px'
			});
		}

	};

	scope.Positionable = [
		StrandTraits.Stylable,
		StrandTraits.AutoClosable,
		StrandTraits.WindowNotifier,
		Positionable
	];

})(window.StrandTraits = window.StrandTraits || {});
</script>