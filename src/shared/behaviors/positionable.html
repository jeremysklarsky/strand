<link rel="import" href="../js/rectangle.html">
<link rel="import" href="windownotifier.html">
<link rel="import" href="autoclosable.html">
<link rel="import" href="stackable.html">
<script type="text/javascript">
	
(function(scope) {

	var Rectangle = StrandLib.Rectangle;

	var Positionable = {

		properties: {
			target: {
				type: Object,
				observer: '_targetChanged'
			},
			state: {
				type: String,
				value: 'closed',
				observer: '_stateChanged'
			},
			offset: {
				type: Number,
				value: 0
			},
			boundaryOffset: {
				type: Number,
				value: 10,
				observer: '_boundaryOffsetChanged'
			}
		},

		resize: function() {
			this.update();
		},
		
		scroll: function() {
			this.update();
		},

		update: function () {
			if(!this.target) return;

			this._updatePosition();
		},

		_updatePosition: function() {},

		get metrics() {
			return Rectangle.fromElement(this);
		},

		get targetMetrics() {
			return this.target && Rectangle.fromElement(this.target);
		},

		get windowMetrics() {
			return new Rectangle(0, 0, document.documentElement.clientWidth, document.documentElement.clientHeight);
		},

		_targetChanged: function(target, oldTarget) {
			if(typeof target === 'string') {
				this.target = document.querySelector(target);
			}
		},

		_stateChanged: function(newState, oldState) {
			if (newState === this.STATE_OPENED) {
				this.update();
				this.style.clip = "auto";
			} else {
				this.style.clip = "rect(0,0,0,0)";
			}
		},

		_boundaryOffsetChanged: function(boundaryOffset) {
			this.style.padding = boundaryOffset + 'px';
		}

	};

	scope.Positionable = [
		StrandTraits.AutoClosable,
		StrandTraits.WindowNotifier,
		StrandTraits.Stackable,
		Positionable
	];

})(window.StrandTraits = window.StrandTraits || {});
</script>