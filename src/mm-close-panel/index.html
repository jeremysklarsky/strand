<!DOCTYPE html>
<html>
	<head>
	<script language="javascript" src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
		<link rel="import" href="../../bower_components/polymer/polymer.html">
		<link rel="import" href="mm-close-panel.html">
		<link rel="import" href="../mm-button/mm-button.html">
		<style>
			body, 
			html {
				margin: 0;
				padding: 0;
				height: 100%;
			}

			body {
				margin: 10px;
				height: 200%;
			}

			#cpb2 {
				position: absolute;
				top: 50%;
				left: 50%;
				margin-left: -51px;
				margin-top: -15px;
			}

			.container {
				width: 200px;
				height: 300px;
				/*background: #fff;*/
			}

			.test {
				transform: translate(100px, 100px);
			}
		</style>

	</head>
	<body>
		<div class="test">
		<mm-button id="cpb2">
			<label>panel target</label>
		</mm-button> 
		
		<mm-close-panel id="cp" direction="e" offset="5" boundary-offset="10">
			<div class="container">
				<mm-button>
					<label>Test</label>
				</mm-button> 
			</div>
		</mm-close-panel>
		</div>

		<script>
			var cp,
				cpb,
				cpb2,
				drag = false;
			
			window.addEventListener("WebComponentsReady", function() {
				cp = document.getElementById("cp"),
				cpb2 = document.getElementById("cpb2"),
				cp.target = cpb2;

				init();
			});

			function init() {
				cpb2.addEventListener("mouseup", handleCpb);
				cpb2.addEventListener("mousedown", handleCpb2MouseDown);
			}

			function handleCpb(e) {
				cp.toggle();
			}

			function handleCpb2MouseDown(e) {
				e.stopPropagation();
				drag = true;
				document.addEventListener("mouseup", handleMouseUp);
				document.addEventListener("mousemove", handleDrag);
			}

			function handleMouseUp(e) {
				drag = false;
				document.removeEventListener("mouseup", handleMouseUp);
				document.removeEventListener("mousemove", handleDrag);
			}

			function handleDrag(e) {
				if (drag === true) {
					cpb2.style.left = e.pageX + "px";
					cpb2.style.top = e.pageY + "px";
					cp.update();
				}
			}
		</script>
	</body>
</html>